<!DOCTYPE html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Pranjal Aswani">
    <meta name="description" content="This is where i will rant about stuff">
    <meta name="keywords" content="blog,developer,personal">

    <base href="https://aswanipranjal.github.io/">
    <title>
  I can almost taste it Â· TOBOR A TON MA I
</title>

    <link rel="canonical" href="https://aswanipranjal.github.io/posts/week-13/">

    <link  rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700">
    <link rel="stylesheet" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" href="https://aswanipranjal.github.io/css/style.min.css">

    <link rel="icon" type="image/png" href="https://aswanipranjal.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://aswanipranjal.github.io/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.40.1" />
  </head>

  <body>
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://aswanipranjal.github.io/">
      TOBOR A TON MA I
    </a>
    
    <ul class="navigation-list float-right">
      
      <li class="navigation-item">
        <a class="navigation-link" href="/posts/">Blog</a>
      </li>
      
      <li class="navigation-item">
        <a class="navigation-link" href="/about/">About</a>
      </li>
      
      <li class="navigation-item">
        <a class="navigation-link" href="/tags/">Tags</a>
      </li>
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
  <article>
    <header>
      <h1 class="title">I can almost taste it</h1>
      <h2 class="date">August 8, 2018</h2>
    </header>

    

<p>Control room!! This is the reporting ship: <em>All tasks are complete</em>. I repeat: <strong>All tasks are complete.</strong></p>

<p>This is the final week of GSoC. I am happy to tell you that we have the first version of the reports done. <a href="https://drive.google.com/file/d/1-3MHbHHWudLkT3rQyQlEsIfSLsogIplA/view?usp=sharing">The PDF looks wonderful</a> and everything is in order. Welcome to the start of the final week of Google Summer of Code.</p>

<h2 style="text-align: center"><bold>In Brief</bold></h2>

<p>Last week we were left with only 2 tasks.</p>

<h5 id="task-5-done">Task-5 [DONE]:</h5>

<p><strong>Task:</strong> <em>To check which metrics still need the relevant fields to be generated so that those metrics can be calculated.</em></p>

<p><strong>Progress</strong>: Last week Valerio <a href="https://github.com/chaoss/grimoirelab-sirmordred/pull/190">created a PR that added a micro mordred</a> capable of running studies and enriching indices.
On the basis of that functionality, I implemented an <code>enrich_pull_requests</code> study on the grimorelab-elk repo. This study allows us to create a pull requests index containing all the data related to the pull requests in a repository.</p>

<p>Related PRs:</p>

<ul>
<li><a href="https://github.com/chaoss/grimoirelab-elk/pull/419">chaoss/grimoirelab-elk/pull/419</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-sirmordred/pull/191">chaoss/grimoirelab-sirmordred/pull/191</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-sirmordred/pull/194">chaoss/grimoirelab-sirmordred/pull/194</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-sirmordred/pull/193">chaoss/grimoirelab-sirmordred/pull/193</a></li>
</ul>

<h5 id="task-7-b-done-tests-remain">Task-7-B [DONE (tests remain)]:</h5>

<p><strong>Task:</strong> <em>To create reports using the functions and classes in <a href="https://github.com/chaoss/grimoirelab-manuscripts/tree/master/manuscripts2">manuscripts2</a></em></p>

<p><strong>Progress:</strong> You might have seen <a href="https://drive.google.com/file/d/1-3MHbHHWudLkT3rQyQlEsIfSLsogIplA/view?usp=sharing">The PDF report</a>. I am still cleaning up the code (I actually needed a break, other wise this would&rsquo;ve been done earlier) and I&rsquo;ll be submitting a PR later in the evening integrating the code to generate the report to the main manuscripts repo.</p>

<p>Related PRs:</p>

<ul>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/97">chaoss/grimoirelab-manuscripts/pull/97</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/99">chaoss/grimoirelab-manuscripts/pull/99</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/100">chaoss/grimoirelab-manuscripts/pull/100</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/101">chaoss/grimoirelab-manuscripts/pull/101</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/102">chaoss/grimoirelab-manuscripts/pull/102</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/103">chaoss/grimoirelab-manuscripts/pull/103</a></li>
<li><a href="https://github.com/chaoss/grimoirelab-manuscripts/pull/104">chaoss/grimoirelab-manuscripts/pull/104</a></li>
</ul>

<p>These PRs add the remaining sections of the report. And with these, we are able to generate all the data to generate a report for the git, github_issues and github_prs data sources.</p>

<p>Moving on..</p>

<h2 style="text-align: center"><bold>In Brief</bold></h2>

<h5 id="task-5">Task-5:</h5>

<p>Continuing from above, I was able to actually figure out how the studies code works and create a study to enrich the pull requests only index. This is amazing to me because I couldn&rsquo;t do it earlier, and then I was able to. I think the secret to this is that you have to sit with the code for a while, turn the knobs and read the manual carefully. &ldquo;Intuition works but tests actually confirm that everything is fine&rdquo;. Thanks to Valerio and the PR that he made. Okay, here is how it works:</p>

<p>The study takes in as input the name of the github_issues raw index. This index contains data regarding the comments on pull requests that are not fetched by perceval when pull requests only data is fetched.
Now, we already know the name of the pull reqeuests only enriched index. We fetch the <code>id_in_repo</code> of all these pull requests. Remember, this repo <em>only</em> contains <em>pull_requests</em> data. So every item in that repo is a pull request.</p>

<p>Once we have the ids of all these pull requests: for each item in the pull requests index, we fetch the corresponding item from the issues index using the id that we got before. This will fetch us the pull requests from the github issues raw index. Now using the data from that index, we can get the required fields. These fields are:</p>

<ul>
<li><strong>Time to first reaction to the pr:</strong> this can be a comment or a review. The pull requests only index already has a value for this field. We calculate if there was a comment on the PR and the time different between that comment and the time when the PR was made. The first review time and the first comment time are compared and the lesser of the two is set as the new value.</li>
<li><strong>Num comments:</strong> these are directly fetched from the github issues raw index.</li>
<li><strong>Comment diversity:</strong> These are the number of people discussing the PR. This can be calulcated by getting the unique users for that PR who commented on the PR.</li>
<li><strong>Comment duration:</strong> this is the time difference between the last commit and when the PR was created. This was calculated by getting the difference between the creation and the last comment date.</li>
</ul>

<p>By using this study, we will be able to get the complete data for pull reqeusts of a repo. The configuration file showing how to use this study can be found here. This study can be used once the PR adding micro mordred is added to Sirmordred(<a href="https://github.com/chaoss/grimoirelab-sirmordred">https://github.com/chaoss/grimoirelab-sirmordred</a>).</p>

<p>And with that, we now have almost all the fields (except <em>num code iterations</em>) that can be used to calculate all the metrics.</p>

<h5 id="task-7-b">Task-7-B:</h5>

<p>This task was to create the grimoirelab-manuscripts reports using the new functions (manuscripts2). The first successful report was generated at 16:27 IST. 3 minutes before today&rsquo;s meeting.</p>

<p>In the last <a href="https://aswanipranjal.github.io/posts/week-12/">blog post</a> we saw how the data source (git, github_pes) files have been stuctured. These files contain classes which are used to calculate the Metrics.</p>

<p>Now, each section of the Report is a function in the data source file. That function can be used to get the appropriate metric values using the classes. The four major sections of the report, taking the example from the previous post itself, are as follows:</p>

<p><span style="color: red">
In manuscripts2/metrics/github.py:
</span></p>

<pre><code class="language-python">def overview(index, start, end):
    &quot;&quot;&quot;Compute metrics in the overview section for enriched github issues
    indexes.
    Returns a dictionary. Each key in the dictionary is the name of
    a metric, the value is the value of that metric. Value can be
    a complex object (eg, a time series).
    :param index: index object
    :param start: start date to get the data from
    :param end: end date to get the data upto
    :return: dictionary with the value of the metrics
    &quot;&quot;&quot;

    results = {
        &quot;activity_metrics&quot;: [OpenedIssues(index, start, end),
                             ClosedIssues(index, start, end)],
        &quot;author_metrics&quot;: [],
        &quot;bmi_metrics&quot;: [BMI(index, start, end)],
        &quot;time_to_close_metrics&quot;: [DaysToCloseMedian(index, start, end)],
        &quot;projects_metrics&quot;: []
    }

    return results
</code></pre>

<p><span style="color: blue">
This function returns the Overview section of the report.
</span></p>

<p><span style="color: red">
In manuscripts2/report.py:
</span></p>

<pre><code class="language-python">def get_sec_overview(self):
        &quot;&quot;&quot;
        Generate the &quot;overview&quot; section of the report.
        &quot;&quot;&quot;

        logger.debug(&quot;Calculating Overview metrics.&quot;)

        data_path = os.path.join(self.data_dir, &quot;overview&quot;)
        if not os.path.exists(data_path):
            os.makedirs(data_path)

        overview_config = {
            &quot;activity_metrics&quot;: [],
            &quot;author_metrics&quot;: [],
            &quot;bmi_metrics&quot;: [],
            &quot;time_to_close_metrics&quot;: [],
            &quot;projects_metrics&quot;: []
        }

        for ds in self.data_sources:
            metric_file = self.ds2class[ds]
            metric_index = self.get_metric_index(ds)
            overview = metric_file.overview(metric_index, self.start_date, self.end_date)
            for section in overview_config:
                overview_config[section] += overview[section]

        overview_config['activity_file_csv'] = &quot;data_source_evolution.csv&quot;
        overview_config['efficiency_file_csv'] = &quot;efficiency.csv&quot;
</code></pre>

<p><span style="color: blue">
The <code>overview</code> function from each of the data source files is called and all the metrics for that section are added to a dictionary.
</span></p>

<pre><code class="language-python">        # ACTIVITY METRICS
        metrics = overview_config['activity_metrics']
        file_name = overview_config['activity_file_csv']
        file_name = os.path.join(data_path, file_name)

        csv = &quot;metricsnames, netvalues, relativevalues, datasource\n&quot;

        for metric in metrics:
            (last, percentage) = get_trend(metric.timeseries())
            csv += &quot;{}, {}, {}, {}\n&quot;.format(metric.name, last,
                                             percentage, metric.DS_NAME)
        create_csv(file_name, csv)

        # AUTHOR METRICS
        &quot;&quot;&quot;
        Git Authors:
        -----------
        Description: average number of developers per month by quarters
        (so we have the average number of developers per month during
        those three months). If the approach is to work at the level of month,
        then just the number of developers per month.
        &quot;&quot;&quot;

        author = overview_config['author_metrics']
        if author:
            authors_by_period = author[0]
            title_label = file_label = authors_by_period.name + ' per ' + self.interval
            file_path = os.path.join(data_path, file_label)
            csv_data = authors_by_period.timeseries(dataframe=True)
            # generate the CSV and the image file displaying the data
            self.create_csv_fig_from_df([csv_data], file_path, [authors_by_period.name],
                                        fig_type=&quot;bar&quot;, title=title_label, xlabel=&quot;time_period&quot;,
                                        ylabel=authors_by_period.id)
        # BMI METRICS
        bmi = []
        bmi_metrics = overview_config['bmi_metrics']
        csv = &quot;&quot;
        for metric in bmi_metrics:
            bmi.append(metric.aggregations())
            csv += metric.id + &quot;, &quot;

        # Time to close METRICS
        ttc = []
        ttc_metrics = overview_config['time_to_close_metrics']
        for metric in ttc_metrics:
            ttc.append(metric.aggregations())
            csv += metric.id + &quot;, &quot;

        # generate efficiency file
        csv = csv[:-2] + &quot;\n&quot;
        csv = csv.replace(&quot;_&quot;, &quot;&quot;)
        bmi.extend(ttc)
        for val in bmi:
            csv += &quot;%s, &quot; % str_val(val)
        if csv[-2:] == &quot;, &quot;:
            csv = csv[:-2]

        file_name = os.path.join(data_path, 'efficiency.csv')
        create_csv(file_name, csv)
        logger.debug(&quot;Overview metrics generation complete!&quot;)

</code></pre>

<p><span style="color: blue">
These metrics are then calculated by calling the <code>timeseries()</code> or <code>aggregations()</code> methods of the Metric classes. The values returned from these methods are stored in files which will then be used when the report is being created using LaTex.
</span></p>

<p><span style="color: red">
Other sections are as follows:
</span></p>

<pre><code class="language-python">def project_activity(index, start, end):
    &quot;&quot;&quot;Compute the metrics for the project activity section of the enriched
    github issues index.
    Returns a dictionary containing a &quot;metric&quot; key. This key contains the
    metrics for this section.
    :param index: index object
    :param start: start date to get the data from
    :param end: end date to get the data upto
    :return: dictionary with the value of the metrics
    &quot;&quot;&quot;

    results = {
        &quot;metrics&quot;: [OpenedIssues(index, start, end),
                    ClosedIssues(index, start, end)]
    }

    return results


def project_community(index, start, end):
    &quot;&quot;&quot;Compute the metrics for the project community section of the enriched
    github issues index.
    Returns a dictionary containing &quot;author_metrics&quot;, &quot;people_top_metrics&quot;
    and &quot;orgs_top_metrics&quot; as the keys and the related Metrics as the values.
    :param index: index object
    :param start: start date to get the data from
    :param end: end date to get the data upto
    :return: dictionary with the value of the metrics
    &quot;&quot;&quot;

    results = {
        &quot;author_metrics&quot;: [],
        &quot;people_top_metrics&quot;: [],
        &quot;orgs_top_metrics&quot;: [],
    }

    return results


def project_process(index, start, end):
    &quot;&quot;&quot;Compute the metrics for the project process section of the enriched
    github issues index.
    Returns a dictionary containing &quot;bmi_metrics&quot;, &quot;time_to_close_metrics&quot;,
    &quot;time_to_close_review_metrics&quot; and patchsets_metrics as the keys and
    the related Metrics as the values.
    time_to_close_title and time_to_close_review_title contain the file names
    to be used for time_to_close_metrics and time_to_close_review_metrics
    metrics data.
    :param index: index object
    :param start: start date to get the data from
    :param end: end date to get the data upto
    :return: dictionary with the value of the metrics
    &quot;&quot;&quot;

    results = {
        &quot;bmi_metrics&quot;: [BMI(index, start, end)],
        &quot;time_to_close_metrics&quot;: [DaysToCloseAverage(index, start, end),
                                  DaysToCloseMedian(index, start, end)],
        &quot;time_to_close_review_metrics&quot;: [],
        &quot;patchsets_metrics&quot;: []
    }

    return results
</code></pre>

<p>The good thing about the new reports is that is uses a lot of already available code (pandas, elasticsearch_dsl) which allows us to focus on the functionality rather than focus on the implementation.</p>

<p>We are using the <a href="https://github.com/chaoss/grimoirelab-manuscripts/tree/master/manuscripts/latex_template">old latex format and directory structure</a> only. I&rsquo;ve tweaked that format a bit so that the images and CSV files are rendered properly. I&rsquo;ll make a PR adding the method to generate the report by today.</p>

<hr />

<p>The final tasks that remain are:</p>

<ul>
<li>Add good testing suite for the reports</li>
<li>Add documentation on how the reports can be generated</li>
<li>Add the Notebooks for GMD and visualizations for the users to have a better hands on approach in looking at the GMD metrics.</li>
<li>setup.py should be updated so that manusripts2 can be used properly.</li>
</ul>

<p>And that is it. I&rsquo;ll be wrting a final report that will contain all the details about the project under GSoC and summarizing the report generation.</p>

<p>Chao!</p>

  </article>
</section>


      </div>

      <footer class="footer">
  <section class="container">
    Â© 2018 Â· Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
  </section>
</footer>

    </main>

    

  </body>

</html>
